<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sortable Tags Table</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@1.0.2/css/bulma.min.css">
  <!-- Include DataTables CSS -->
  <link rel="stylesheet" href="https://cdn.datatables.net/2.1.8/css/dataTables.bulma.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/2.3.3/css/searchPanes.bulma.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/select/2.1.0/css/select.bulma.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.9.0/css/regular.min.css">
  <link rel="stylesheet" href="https://cdn.datatables.net/fixedheader/4.0.1/css/fixedHeader.bulma.min.css">


</head>
<body>
  <section class="section">
    <h1 class="title">Docker Images</h1>
    <h2 class="subtitle"><strong>Apik</strong>.cloud</h2>

    <table id="tagsTable" class="table is-striped" style="width:100%">
      <thead>
        <tr>
          <th>Version</th>
          <th>Edition</th>
          <th>Release</th>
          <th>Name</th>
          <th>Image</th>
          <th>Size</th>
          <th>Last Updated</th>
          <th>Last Pulled</th>
        </tr>
      </thead>
      <tbody>
      </tbody>
    </table>
  </section>

  <!-- Include jQuery and DataTables JS -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.datatables.net/2.1.8/js/dataTables.min.js"></script>
  <script src="https://cdn.datatables.net/2.1.8/js/dataTables.bulma.min.js"></script>
  <script src="https://cdn.datatables.net/searchpanes/2.3.3/js/dataTables.searchPanes.min.js"></script>
  <script src="https://cdn.datatables.net/searchpanes/2.3.3/js/searchPanes.bulma.min.js"></script>
  <script src="https://cdn.datatables.net/select/2.1.0/js/dataTables.select.min.js"></script>
  <script src="https://cdn.datatables.net/select/2.1.0/js/select.bulma.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/4.0.1/js/dataTables.fixedHeader.min.js"></script>
  <script src="https://cdn.datatables.net/fixedheader/4.0.1/js/fixedHeader.bulma.min.js"></script>

  <script>
    document.addEventListener('DOMContentLoaded', async () => {
      try {
        // Fetch the JSON data
        const response = await fetch('./tags.json');
        const tags = await response.json();

        let data = tags.map(tag => ({
          id: tag.id,
          name: tag.name,
          image: `<a href="https://hub.docker.com/r/${tag.image}" target="_blank">${tag.image}</a> <button class="button is-small copy-btn dtsp-searchIcon" data-image="${tag.image}">Copy</button>`,
          size: (tag.full_size / 1024 / 1024).toFixed(2) + ' MB', // Convert to MB
          status: tag.tag_status,
          last_pulled: new Date(tag.tag_last_pulled).toLocaleString(),
          last_pushed: new Date(tag.tag_last_pushed).toLocaleString(),
          last_updated: new Date(tag.last_updated).toLocaleString(),
          digest: tag.digest,
          version: tag.majorVersion,
          edition: tag.edition == 'community' ? `<span class="tag is-dark"> ${tag.edition} </span>` : `<span class="tag is-primary"> ${tag.edition} </span>`,
          // release: tag.release
          release: new Date(tag.release.replace(/^(\d{4})(\d{2})(\d{2})$/, '$1-$2-$3')).toLocaleDateString()
        }));

        const table = $('#tagsTable').DataTable({
          data: data,
          columns: [
            { data: 'version' },
            { data: 'edition' },
            { data: 'release' },
            { data: 'name' },
            { data: 'image' },
            { data: 'size' },
            { data: 'last_updated' },
            { data: 'last_pulled' }
          ],
          columnDefs: [
            { targets: [0], className: 'has-text-left' },
          ],
          order: [[0, 'desc'],[2, 'desc']],
          layout: {
            top1: 'searchPanes',
            topStart: 'search',
            topEnd: 'pageLength'
          },
          searchPanes: {
              initCollapsed: true
          },
          fixedHeader: {
            header: true,
            headerOffset: $('#fixed').height()
          },
          paging: true,
          pageLength: 10,
          info: true,
          initComplete: function (settings, json) {
            $('#dt-search-0').focus();
          }
        });

        // Add event listener for copy buttons
        $('#tagsTable tbody').on('click', '.copy-btn', function() {
          const image = $(this).data('image');
          navigator.clipboard.writeText(image)
        });
      } catch (error) {
        console.error('Error loading tags.json:', error);
      }
    });
  </script>
</body>
</html>
